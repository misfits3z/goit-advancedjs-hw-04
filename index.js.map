{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport axios from \"axios\";\n\naxios.defaults.baseURL = 'https://pixabay.com/api/'\nconst API_KEY = '46457503-330abda4e6a20c9fb19d2e08a';\n\nlet page = 1;\n\nasync function getPhotos(query, resetPage = false) {\n    if (resetPage) {\n        page = 1;\n    }\n\n    try {\n        const response = await axios('', {\n            params: {\n                key: API_KEY,\n                q: query,\n                page: page,\n                per_page: 15,\n            }\n        });\n\n        const data = response.data;\n\n        if (data.totalHits > 0) {\n            page += 1;\n            return { hits: data.hits, totalHits: data.totalHits }; \n        } else {\n            iziToast.error({\n                message: `Sorry, there are no images matching your search query. Please try again!`,\n                position: \"topRight\",\n                timeout: 2000,\n                color: \"#FF0000\",\n                messageColor: \"#FFFFFF\",\n            });\n            return { hits: [], totalHits: 0 }; \n        }\n    } catch (err) {\n        console.log(err);\n        return { hits: [], totalHits: 0 }; \n    }\n}\nexport { getPhotos };\n\n\n\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css'; \n\n\nconst createGalleryItems = (cards) => {\n    return cards.map(({ largeImageURL, webformatURL, tags, likes, views, comments, downloads }) => \n      `<li class=\"gallery-item\">\n        <a class=\"gallery-link\" href=\"${largeImageURL}\">\n          <img\n            class=\"gallery-image\"\n            src=\"${webformatURL}\"\n            alt=\"${tags}\"\n          />\n        </a>\n        <div class=\"gallery-info\">\n          <p><b>Likes:</b> ${likes}</p>\n          <p><b>Views:</b> ${views}</p>\n          <p><b>Comments:</b> ${comments}</p>\n          <p><b>Downloads:</b> ${downloads}</p>\n        </div>\n      </li>`\n    ).join('');\n  };\n  \n  \n  \n  const initLightbox = () => {\n    const lightbox = new SimpleLightbox('.gallery .gallery-item a', {\n      captions: true,\n      captionsData: 'alt',\n      captionDelay: 250,\n      animationSpeed: 300,\n    });\n    \n    lightbox.refresh();\n  };\n  \n\nexport default createGalleryItems;\nexport { createGalleryItems, initLightbox };","// 46457503-330abda4e6a20c9fb19d2e08a\n// https://pixabay.com/api/\nimport { getPhotos } from \"./js/pixabay-api\";\nimport {createGalleryItems, initLightbox} from \"./js/render-functions\";\nimport iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\n\n\nconst searchFormEl = document.querySelector('.js-search-form');\nconst galleryEl = document.querySelector('.js-gallery');\nconst loadMore = document.querySelector('.btn')\nconst loader = document.querySelector('.loader');\n\nlet userQuery = '';\nlet page = 1;\nlet totalHits = 0; \nlet totalLoadedImages = 0;\n\nloadMore.style.display = 'none';\n\n\nsearchFormEl.addEventListener(\"submit\", handleSearch)\n\nlet isFirstLoad = true;\n\nasync function handleSearch(event) {\n    event.preventDefault();\n\n    userQuery = event.currentTarget.elements.user_query.value.trim();\n    galleryEl.innerHTML = '';\n    loader.style.display = 'block';\n    loadMore.style.display = 'none';\n\n    page = 1;\n    totalLoadedImages = 0;\n\n    try {\n        const { hits, totalHits: fetchedTotalHits } = await getPhotos(userQuery, true);\n\n        if (hits.length > 0) {\n            totalHits = fetchedTotalHits;\n            totalLoadedImages += hits.length;\n\n            const galleryMarkup = createGalleryItems(hits);\n            galleryEl.insertAdjacentHTML('beforeend', galleryMarkup);\n\n            initLightbox();\n            if (totalLoadedImages < totalHits) {\n                loadMore.style.display = 'block';\n            } else {\n                iziToast.info({\n                    message: `We're sorry, but you've reached the end of search results.`,\n                    position: \"topRight\",\n                    timeout: 2000,\n                    color: \"lightblue\",\n                    messageColor: \"#FFFFFF\",\n                });\n            }\n        }\n        if (!isFirstLoad) {\n            smoothScroll();\n        }\n        isFirstLoad = false; \n\n    } catch (err) {\n        console.log(err);\n    } finally {\n        loader.style.display = 'none';\n        searchFormEl.reset();\n    }\n}\n\nloadMore.addEventListener('click', handleLoad);\n\nasync function handleLoad() {\n    loader.style.display = 'block';\n\n    try {\n        const { hits } = await getPhotos(userQuery, false);\n\n        if (hits.length > 0) {\n            totalLoadedImages += hits.length;\n\n            const galleryMarkup = createGalleryItems(hits);\n            galleryEl.insertAdjacentHTML('beforeend', galleryMarkup);\n\n            initLightbox();\n        }\n        if (!isFirstLoad) {\n            smoothScroll();\n        }\n\n        if (totalLoadedImages >= totalHits) {\n            loadMore.style.display = 'none';\n            iziToast.info({\n                message: `We're sorry, but you've reached the end of search results.`,\n                position: \"topRight\",\n                timeout: 2000,\n                color: \"orange\",\n                messageColor: \"#FFFFFF\",\n            });\n        }\n    } catch (err) {\n        console.log(err);\n    } finally {\n        loader.style.display = 'none';\n    }\n}\n\n\nfunction smoothScroll() {\n    const { height: cardHeight } = galleryEl.firstElementChild.getBoundingClientRect();\n    \n    window.scrollBy({\n        top: cardHeight * 2, \n        behavior: 'smooth', \n    });\n}\n"],"names":["axios","API_KEY","page","getPhotos","query","resetPage","data","iziToast","err","createGalleryItems","cards","largeImageURL","webformatURL","tags","likes","views","comments","downloads","initLightbox","SimpleLightbox","searchFormEl","galleryEl","loadMore","loader","userQuery","totalHits","totalLoadedImages","handleSearch","isFirstLoad","event","hits","fetchedTotalHits","galleryMarkup","smoothScroll","handleLoad","cardHeight"],"mappings":"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"}